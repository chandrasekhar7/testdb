-- =====================================================================================================================
-- Author      :	Brice Lohman
-- Create date :    20230403
-- Description :	Deletes Call Recordings 10 years + 1 day old.
-- =====================================================================================================================
CREATE PROCEDURE [dbo].[DeleteLegacyCallRecordings]

/***********************************************************************************************************************
--------------Change History----------------------section START---------------------------------------------------------
************************************************************************************************************************
DEVELOPER 		DATE	        CARD                                    DESCRIPTION

************************************************************************************************************************
--------------Change History----------------------section END-----------------------------------------------------------
************************************************************************************************************************/
AS
BEGIN
	SET NOCOUNT ON;

    DELETE FROM [CallCenterV2].[dbo].[Recordings]
     WHERE RecordingUI IN 
     (
        SELECT RecordingUI
          FROM [CallCenterV2].[dbo].[AgentCalls] AC
          INNER JOIN [CallCenterV2].[dbo].[Recordings] R ON R.AgentCallID = AC.CallID
         WHERE AC.CallStart < CAST(DATEADD(DAY, -1, DATEADD(YEAR, -10, GETDATE())) as date)
     );
	
END